@model BookViewModel
@{
    ViewData["Title"] = Model.Title;
    var borrows = ViewData["Borrows"] as List<BorrowViewModel>;
    ReaderViewModel reader = new ReaderViewModel();
    BorrowViewModel currentBorrow = new BorrowViewModel(); 
    if(Model.IsBorrowed)
    {
        currentBorrow = borrows.FirstOrDefault(x => !x.IsReturned);
        reader = currentBorrow.Reader;
    }

    var borrowsHistory = borrows.Where(x => x.IsReturned).ToList();
}


<h1>
    @Model.Title
    <small class="text-muted fw-light">#@Model.Id</small>
</h1> 
<h5>@Resources.Book.Author: <i class="fw-normal">@(Model.Author.FirstName + " " + Model.Author.LastName)</i></h5>
<h5>@Resources.Book.Publication_Year: <i class="fw-normal">@Model.PublishYear</i></h5>
<a class="text-decoration-none" onclick="location.href = '@Url.Action("Delete", "Book", new {bookId = Model.Id})'"><small class="text-danger fw-bold">@Resources.Common.Delete</small></a>
<hr />

    @if(Model.IsBorrowed)
    {
        <p>@Resources.Book.Is_Borrowed_Info <text class="text-danger fw-bold">@Resources.Book.Borrowed_Info_1</text>
        @Resources.Book.Borrowed_Info_2 <b>@(reader.FirstName + " " + reader.LastName)</b> @Resources.Book.Borrowed_Info_3 @currentBorrow.BorrowDate.ToString("dd MMMM yyyy") 
        @Resources.Book.Borrowed_Info_4 @currentBorrow.ReturnDeadline.ToString("dd MMMM yyyy").</p>
    }
    else
    {
        <p>@Resources.Book.Is_Borrowed_Info <text class="text-success fw-bold">@Resources.Book.Unborrowed_Info</text>.</p>
    }

<h4>@Resources.Book.History_Of_Borrows</h4>

<hr />

<table class="table">
    <thead>
        <tr>
            <th>@Resources.Common.Reader</th>
            <th>@Resources.Common.Borrow_Date</th>
            <th>@Resources.Common.Return_Deadline</th>
            <th>@Resources.Common.Return_Date</th>
        </tr>
    </thead>
    <tbody>
        @foreach(var borrow in borrowsHistory)
        {
            <tr class="not-clickable">
                <td>@(borrow.Reader.FirstName + " " + borrow.Reader.LastName)</td>
                <td>@borrow.BorrowDate.ToString("dd MMMM yyyy")</td>
                <td>@borrow.ReturnDeadline.ToString("dd MMMM yyyy")</td>
                <td>@(((DateTime)borrow.ReturnDate).ToString("dd MMMM yyyy"))</td>
            </tr>
        }
    </tbody>
</table>

@if (borrowsHistory.Count == 0)
{
    <p>@Resources.Common.Nothing_To_Show_Here</p>
}